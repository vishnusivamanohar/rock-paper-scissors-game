<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rock Paper Scissors - Two Player</title>
    <style>
        body{background:#121212;color:white;font-family:Arial,sans-serif;text-align:center;padding:20px;margin:0}.navbar{display:flex;justify-content:space-between;align-items:center;padding:5px 30px;background:linear-gradient(to right,#00ffcc,#006666);box-shadow:0 2px 10px rgba(0,255,204,.3);border-radius:10px;margin-bottom:20px}.navbar .logo{font-size:22px;font-weight:700;color:#121212;text-shadow:0 0 2px #fff}.nav-link{text-decoration:none;background:#121212;padding:10px 20px;color:#00ffcc;border-radius:8px;font-weight:700;transition:.3s ease;border:1px solid #00ffaa}.nav-link:hover{background:#00ffaa;color:#121212;box-shadow:0 0 10px #00ffaa}.game-board{display:flex;justify-content:space-around;align-items:flex-start;background:#1f1f1f;border-radius:10px;padding:20px;gap:20px;box-shadow:0 0 15px #00ffcc;max-width:1100px;margin:auto}.player-panel,.result-panel{flex:1;padding:20px;border-radius:8px;min-height:350px}.player-panel{background:#2a2a2a}.result-panel{flex:1.2;background:#1a1a1a}.player-panel h2,.result-panel h2{margin-top:0;color:#00ffcc}input[type=text]{width:80%;padding:10px;border:1px solid #ccc;border-radius:5px;font-size:16px;margin-bottom:15px;background:#333;color:#fff;border-color:#00ffcc}button{padding:10px 20px;margin:5px;font-size:18px;border:none;border-radius:8px;cursor:pointer;background-color:#00ffcc;color:#000;transition:.2s ease;width:90%}button:hover:not(:disabled){background-color:#00ffaa;transform:translateY(-2px)}button:disabled{background-color:#555;color:#aaa;cursor:not-allowed}#round-outcome{font-size:1.8em;font-weight:700;color:#ffc107;min-height:60px;display:flex;align-items:center;justify-content:center}.submit-btn{background:#e91e63;color:#fff;margin-top:20px;width:auto}.choice-btn.selected{box-shadow:0 0 15px 5px #ffc107;transform:scale(1.05)}.ready-btn{background-color:#4CAF50}.ready-btn.waiting{background-color:#ff9800}
        .music-control{position:fixed;bottom:10px;right:10px;background:#00ffcc;color:#121212;border:none;width:45px;height:45px;border-radius:50%;cursor:pointer;font-size:25px;box-shadow:0 0 10px rgba(0,255,204,.5);z-index:100;display:flex;align-items:center;justify-content:center;padding:0}
        .music-control span{display:inline-block;line-height:1;margin-top:-2px}
    </style>
</head>
<body>
    <audio id="bgMusic" loop>
        <source src="{{ url_for('static', filename='bg-music(plsent).mp3') }}" type="audio/mpeg">
    </audio>
    <button class="music-control" id="musicToggle"><span>üîä</span></button>

    <div class="navbar">
        <div class="logo">üåü Two-Player RPS (<a href="{{ url_for('index') }}">Single Player</a>)</div>
        <a href="{{ url_for('scores_double') }}" class="nav-link">LEADERBOARD</a>
    </div>

    <marquee style="color:#00ffcc; font-size: 16px; padding: 5px 0;">Player 1 Controls: A (Rock), S (Paper), D (Scissors) | Player 2 Controls: J (Rock), K (Paper), L (Scissors) | Press ENTER to start the round!</marquee>
    
    <form method="POST" action="{{ url_for('submit_double') }}" id="game-form">
        <div class="game-board">
            <div class="player-panel" id="player1-panel">
                <input type="text" id="player1_name_input" name="player1_name" placeholder="Enter Player 1 Name" required>
                <h2 id="p1-title">Player 1</h2>
                <button type="button" class="ready-btn" id="p1-ready-btn" onclick="playerReady('p1')">Ready</button>
                <div class="player-controls" id="p1-controls" style="margin-top: 15px;">
                    <button type="button" class="choice-btn" onclick="makeChoice('p1', 'rock')" disabled>üåë Rock</button>
                    <button type="button" class="choice-btn" onclick="makeChoice('p1', 'paper')" disabled>üìÑ Paper</button>
                    <button type="button" class="choice-btn" onclick="makeChoice('p1', 'scissors')" disabled>‚úÇÔ∏è Scissors</button>
                </div>
            </div>

            <div class="result-panel">
                <h2>Game Result</h2>
                <div class="result-display">
                    <p id="round-outcome">Click 'Ready' or Press Enter to start!</p>
                </div>
                <div class="score-display">
                    <h3>Scores</h3>
                    <p><span id="p1-score-name">Player 1</span> Wins: <span id="p1-wins">0</span></p>
                    <p><span id="p2-score-name">Player 2</span> Wins: <span id="p2-wins">0</span></p>
                    <p>Draws: <span id="draws">0</span></p>
                    <p>Total Attempts: <span id="total_atempts">0</span></p>
                </div>
                 <button type="submit" class="submit-btn">üîÑ Submit Scores & Reset Game</button>
            </div>

            <div class="player-panel" id="player2-panel">
                <input type="text" id="player2_name_input" name="player2_name" placeholder="Enter Player 2 Name" required>
                <h2 id="p2-title">Player 2</h2>
                <button type="button" class="ready-btn" id="p2-ready-btn" onclick="playerReady('p2')">Ready</button>
                <div class="player-controls" id="p2-controls" style="margin-top: 15px;">
                    <button type="button" class="choice-btn" onclick="makeChoice('p2', 'rock')" disabled>üåë Rock</button>
                    <button type="button" class="choice-btn" onclick="makeChoice('p2', 'paper')" disabled>üìÑ Paper</button>
                    <button type="button" class="choice-btn" onclick="makeChoice('p2', 'scissors')" disabled>‚úÇÔ∏è Scissors</button>
                </div>
            </div>
        </div>

        <input type="hidden" name="p1_wins" id="p1_wins_hidden">
        <input type="hidden" name="p2_wins" id="p2_wins_hidden">
        <input type="hidden" name="draws" id="draws_hidden">
    </form>

    <script>
        let p1_choice = null, p2_choice = null, p1_ready = false, p2_ready = false, total_attempts = 0, isChoiceWindowOpen = false;
        const scores = { p1Wins: 0, p2Wins: 0, draws: 0 };
        const outcomeElement = document.getElementById('round-outcome');
        
        function playerReady(player) {
            const nameInput = document.getElementById(player === 'p1' ? 'player1_name_input' : 'player2_name_input');
            if (nameInput.value.trim() === '') {
                alert(`Please enter a name for ${player === 'p1' ? 'Player 1' : 'Player 2'}.`);
                return;
            }

            const readyBtn = document.getElementById(`${player}-ready-btn`);
            if (player === 'p1') {
                p1_ready = true;
                readyBtn.textContent = 'Waiting for P2...';
                readyBtn.classList.add('waiting');
            } else {
                p2_ready = true;
                readyBtn.textContent = 'Waiting for P1...';
                readyBtn.classList.add('waiting');
            }
            readyBtn.disabled = true;

            if (p1_ready && p2_ready) startCountdown();
        }

        function startCountdown() {
            let count = 3;
            outcomeElement.textContent = 'Get Ready!';
            const countdownInterval = setInterval(() => {
                if (count > 0) {
                    outcomeElement.textContent = count;
                    count--;
                } else {
                    clearInterval(countdownInterval);
                    outcomeElement.textContent = 'SHOOT!';
                    enableChoiceWindow();
                }
            }, 1000);
        }

       function enableChoiceWindow() {
            isChoiceWindowOpen = true;
            document.querySelectorAll('#p1-controls .choice-btn, #p2-controls .choice-btn').forEach(btn => btn.disabled = false);
            setTimeout(endChoiceWindow, 1500);
        }

        function makeChoice(player, choice) {
            if (player === 'p1' && !p1_choice) {
                p1_choice = choice;
                highlightChoice(player, choice);
                disablePlayerButtons(player);
            } else if (player === 'p2' && !p2_choice) {
                p2_choice = choice;
                highlightChoice(player, choice);
                disablePlayerButtons(player);
            }

            if (p1_choice && p2_choice) {
                endChoiceWindow();
            }
        }

        function highlightChoice(player, choice) {
            const buttons = document.querySelectorAll(`#${player}-controls .choice-btn`);
            buttons.forEach(btn => {
                if (btn.textContent.toLowerCase().includes(choice)) {
                    btn.classList.add('selected');
                }
            });
        }

        function disablePlayerButtons(player) {
            document.querySelectorAll(`#${player}-controls .choice-btn`).forEach(btn => btn.disabled = true);
        }

        function endChoiceWindow() {
            if (!isChoiceWindowOpen) return;
            isChoiceWindowOpen = false;
            toggleChoiceButtons(true);
            determineWinner();
        }

        function determineWinner() {
            total_attempts++;
            const p1Name = document.getElementById('player1_name_input').value || 'Player 1';
            const p2Name = document.getElementById('player2_name_input').value || 'Player 2';
            
            if (!p1_choice && !p2_choice) {
                outcomeElement.textContent = "You both missed! No points.";
            } else if (!p1_choice) {
                outcomeElement.innerHTML = `${p1Name} didn't choose! No points awarded.`;
            } else if (!p2_choice) {
                outcomeElement.innerHTML = `${p2Name} didn't choose! No points awarded.`;
            } else if (p1_choice === p2_choice) {
                scores.draws++;
                outcomeElement.innerHTML = `It's a Draw! <br><small>You both chose ${p1_choice}</small>`;
            } else if ((p1_choice === 'rock' && p2_choice === 'scissors') || (p1_choice === 'paper' && p2_choice === 'rock') || (p1_choice === 'scissors' && p2_choice === 'paper')) {
                scores.p1Wins++;
                outcomeElement.innerHTML = `${p1Name} Wins! <br><small>${p1_choice} beats ${p2_choice}</small>`;
            } else {
                scores.p2Wins++;
                outcomeElement.innerHTML = `${p2Name} Wins! <br><small>${p2_choice} beats ${p1_choice}</small>`;
            }
            
            updateScores();
            setTimeout(resetRound, 3000);
        }

        function updateScores() {
            document.getElementById('p1-wins').textContent = scores.p1Wins;
            document.getElementById('p2-wins').textContent = scores.p2Wins;
            document.getElementById('draws').textContent = scores.draws;
            document.getElementById('total_atempts').textContent = total_attempts;
        }

        function resetRound() {
            p1_choice = null; p2_choice = null; p1_ready = false; p2_ready = false;
            
            const p1ReadyBtn = document.getElementById('p1-ready-btn');
            const p2ReadyBtn = document.getElementById('p2-ready-btn');
            p1ReadyBtn.disabled = false;
            p2ReadyBtn.disabled = false;
            p1ReadyBtn.textContent = 'Ready';
            p2ReadyBtn.textContent = 'Ready';
            p1ReadyBtn.classList.remove('waiting');
            p2ReadyBtn.classList.remove('waiting');

            document.querySelectorAll('.choice-btn').forEach(btn => btn.classList.remove('selected'));
            
            outcomeElement.textContent = "Click 'Ready' or Press Enter to start!";
        }

        function toggleChoiceButtons(disabled) {
            document.querySelectorAll('.choice-btn').forEach(btn => btn.disabled = disabled);
        }

        document.getElementById('game-form').addEventListener('submit', function(event) {
            document.getElementById('p1_wins_hidden').value = scores.p1Wins;
            document.getElementById('p2_wins_hidden').value = scores.p2Wins;
            document.getElementById('draws_hidden').value = scores.draws;
        });

        document.addEventListener('keydown', function(event) {
            const key = event.key.toLowerCase();
            
            if (event.key === 'Enter') {
                event.preventDefault();
                if (!p1_ready && !p2_ready) {
                    document.getElementById('p1-ready-btn').click();
                    document.getElementById('p2-ready-btn').click();
                }
            }
            
            if (!isChoiceWindowOpen) return; 

            if (!p1_choice && ['a', 's', 'd'].includes(key)) {
                let choice = key === 'a' ? 'rock' : key === 's' ? 'paper' : 'scissors';
                makeChoice('p1', choice);
            }

            if (!p2_choice && ['j', 'k', 'l'].includes(key)) {
                let choice = key === 'j' ? 'rock' : key === 'k' ? 'paper' : 'scissors';
                makeChoice('p2', choice);
            }
        });
    </script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const music = document.getElementById('bgMusic');
        const toggleBtn = document.getElementById('musicToggle');
        
        const savedState = localStorage.getItem('musicPlaying');
        
        if (savedState === 'true') {
          music.play().catch(e => {
            console.log("Autoplay blocked:", e);
            toggleBtn.innerHTML = '<span>üîá</span>';
          });
        }
        
        toggleBtn.addEventListener('click', function() {
          if (music.paused) {
            music.play()
              .then(() => {
                toggleBtn.innerHTML = '<span>üîä</span>';
                localStorage.setItem('musicPlaying', 'true');
              })
              .catch(e => {
                console.log("Playback failed:", e);
                toggleBtn.innerHTML = '<span>üîá</span>';
              });
          } else {
            music.pause();
            toggleBtn.innerHTML = '<span>üîá</span>';
            localStorage.setItem('musicPlaying', 'false');
          }
        });
        
        music.addEventListener('play', () => {
          toggleBtn.innerHTML = '<span>üîä</span>';
        });
        
        music.addEventListener('pause', () => {
          toggleBtn.innerHTML = '<span>üîá</span>';
        });
        
        toggleBtn.innerHTML = music.paused ? '<span>üîá</span>' : '<span>üîä</span>';
      });
    </script>
</body>
</html>
